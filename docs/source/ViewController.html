<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// Generated by CoffeeScript 1.3.3
/*
Copyright (c) 2012 [DeftJS Framework Contributors](http://deftjs.org)
Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
*/

<span id='global-property-'>/**
</span>A lightweight MVC view controller.

Used in conjunction with {@link Carcasse.mixin.Controllable}.
*/

Carcasse.define('Carcasse.mvc.ViewController', {
  alternateClassName: ['Carcasse.ViewController'],
  requires: ['Carcasse.log.Logger'],
  config: {
<span id='global-property-view'>    /**
</span>    		View controlled by this ViewController.
    */

    view: null
  },
  constructor: function(config) {
    this.initConfig(config);
    if (this.getView() instanceof Carcasse.ClassManager.get('Carcasse.Component')) {
      this.registeredComponents = {};
      this.isExtJS = this.getView().events != null;
      this.isSenchaTouch = !this.isExtJS;
      if (this.isExtJS) {
        if (this.getView().rendered) {
          this.onViewInitialize();
        } else {
          this.getView().on('afterrender', this.onViewInitialize, this, {
            single: true
          });
        }
      } else {
        if (this.getView().initialized) {
          this.onViewInitialize();
        } else {
          this.getView().on('initialize', this.onViewInitialize, this, {
            single: true
          });
        }
      }
    } else {
      Carcasse.Error.raise({
        msg: 'Error constructing ViewController: the configured \'view\' is not an Carcasse.Component.'
      });
    }
    return this;
  },
<span id='global-method-init'>  /**
</span>  	Initialize the ViewController
  */

  init: function() {},
<span id='global-method-destroy'>  /**
</span>  	Destroy the ViewController
  */

  destroy: function() {
    return true;
  },
<span id='global-method-onViewInitialize'>  /**
</span>  	@private
  */

  onViewInitialize: function() {
    var component, config, id, listeners, originalViewDestroyFunction, self, _ref;
    if (this.isExtJS) {
      this.getView().on('beforedestroy', this.onViewBeforeDestroy, this);
      this.getView().on('destroy', this.onViewDestroy, this, {
        single: true
      });
    } else {
      self = this;
      originalViewDestroyFunction = this.getView().destroy;
      this.getView().destroy = function() {
        if (self.destroy()) {
          originalViewDestroyFunction.call(this);
        }
      };
    }
    _ref = this.control;
    for (id in _ref) {
      config = _ref[id];
      component = this.locateComponent(id, config);
      listeners = Carcasse.isObject(config.listeners) ? config.listeners : !(config.selector != null) ? config : void 0;
      this.registerComponent(id, component, listeners);
    }
    this.init();
  },
<span id='global-method-onViewBeforeDestroy'>  /**
</span>  	@private
  */

  onViewBeforeDestroy: function() {
    if (this.destroy()) {
      this.getView().un('beforedestroy', this.onBeforeDestroy, this);
      return true;
    }
    return false;
  },
<span id='global-method-onViewDestroy'>  /**
</span>  	@private
  */

  onViewDestroy: function() {
    var id;
    for (id in this.registeredComponents) {
      this.unregisterComponent(id);
    }
  },
<span id='global-method-getComponent'>  /**
</span>  	@private
  */

  getComponent: function(id) {
    var _ref;
    return (_ref = this.registeredComponents[id]) != null ? _ref.component : void 0;
  },
<span id='global-method-registerComponent'>  /**
</span>  	@private
  */

  registerComponent: function(id, component, listeners) {
    var event, existingComponent, fn, getterName, listener, options, scope;
    Carcasse.Logger.log(&quot;Registering '&quot; + id + &quot;' component.&quot;);
    existingComponent = this.getComponent(id);
    if (existingComponent != null) {
      Carcasse.Error.raise({
        msg: &quot;Error registering component: an existing component already registered as '&quot; + id + &quot;'.&quot;
      });
    }
    this.registeredComponents[id] = {
      component: component,
      listeners: listeners
    };
    if (id !== 'view') {
      getterName = 'get' + Carcasse.String.capitalize(id);
      if (!this[getterName]) {
        this[getterName] = Carcasse.Function.pass(this.getComponent, [id], this);
      }
    }
    if (Carcasse.isObject(listeners)) {
      for (event in listeners) {
        listener = listeners[event];
        fn = listener;
        scope = this;
        options = null;
        if (Carcasse.isObject(listener)) {
          options = Carcasse.apply({}, listener);
          if (options.fn != null) {
            fn = options.fn;
            delete options.fn;
          }
          if (options.scope != null) {
            scope = options.scope;
            delete options.scope;
          }
        }
        Carcasse.Logger.log(&quot;Adding '&quot; + event + &quot;' listener to '&quot; + id + &quot;'.&quot;);
        if (Carcasse.isFunction(fn)) {
          component.on(event, fn, scope, options);
        } else if (Carcasse.isFunction(this[fn])) {
          component.on(event, this[fn], scope, options);
        } else {
          Carcasse.Error.raise({
            msg: &quot;Error adding '&quot; + event + &quot;' listener: the specified handler '&quot; + fn + &quot;' is not a Function or does not exist.&quot;
          });
        }
      }
    }
  },
<span id='global-method-unregisterComponent'>  /**
</span>  	@private
  */

  unregisterComponent: function(id) {
    var component, event, existingComponent, fn, getterName, listener, listeners, options, scope, _ref;
    Carcasse.Logger.log(&quot;Unregistering '&quot; + id + &quot;' component.&quot;);
    existingComponent = this.getComponent(id);
    if (!(existingComponent != null)) {
      Carcasse.Error.raise({
        msg: &quot;Error unregistering component: no component is registered as '&quot; + id + &quot;'.&quot;
      });
    }
    _ref = this.registeredComponents[id], component = _ref.component, listeners = _ref.listeners;
    if (Carcasse.isObject(listeners)) {
      for (event in listeners) {
        listener = listeners[event];
        fn = listener;
        scope = this;
        if (Carcasse.isObject(listener)) {
          options = listener;
          if (options.fn != null) {
            fn = options.fn;
          }
          if (options.scope != null) {
            scope = options.scope;
          }
        }
        Carcasse.Logger.log(&quot;Removing '&quot; + event + &quot;' listener from '&quot; + id + &quot;'.&quot;);
        if (Carcasse.isFunction(fn)) {
          component.un(event, fn, scope);
        } else if (Carcasse.isFunction(this[fn])) {
          component.un(event, this[fn], scope);
        } else {
          Carcasse.Error.raise({
            msg: &quot;Error removing '&quot; + event + &quot;' listener: the specified handler '&quot; + fn + &quot;' is not a Function or does not exist.&quot;
          });
        }
      }
    }
    if (id !== 'view') {
      getterName = 'get' + Carcasse.String.capitalize(id);
      this[getterName] = null;
    }
    this.registeredComponents[id] = null;
  },
<span id='global-method-locateComponent'>  /**
</span>  	@private
  */

  locateComponent: function(id, config) {
    var matches, view;
    view = this.getView();
    if (id === 'view') {
      return view;
    }
    if (Carcasse.isString(config)) {
      matches = view.query(config);
      if (matches.length === 0) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: no component found matching '&quot; + config + &quot;'.&quot;
        });
      }
      if (matches.length &gt; 1) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: multiple components found matching '&quot; + config + &quot;'.&quot;
        });
      }
      return matches[0];
    } else if (Carcasse.isString(config.selector)) {
      matches = view.query(config.selector);
      if (matches.length === 0) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: no component found matching '&quot; + config.selector + &quot;'.&quot;
        });
      }
      if (matches.length &gt; 1) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: multiple components found matching '&quot; + config.selector + &quot;'.&quot;
        });
      }
      return matches[0];
    } else {
      matches = view.query('#' + id);
      if (matches.length === 0) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: no component found with an itemId of '&quot; + id + &quot;'.&quot;
        });
      }
      if (matches.length &gt; 1) {
        Carcasse.Error.raise({
          msg: &quot;Error locating component: multiple components found with an itemId of '&quot; + id + &quot;'.&quot;
        });
      }
      return matches[0];
    }
  }
});
</pre>
</body>
</html>
