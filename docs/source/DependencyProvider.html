<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// Generated by CoffeeScript 1.3.3
/*
Copyright (c) 2012 [DeftJS Framework Contributors](http://deftjs.org)
Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
*/

<span id='global-property-'>/**
</span>@private

Used by {@link Deft.ioc.Injector}.
*/

Carcasse.define('Deft.ioc.DependencyProvider', {
  requires: ['Deft.log.Logger'],
  config: {
    identifier: null,
<span id='global-property-className'>    /**
</span>    		Class to be instantiated, by either full name, alias or alternate name, to resolve this dependency.
    */

    className: null,
<span id='global-property-parameters'>    /**
</span>    		Optional arguments to pass to the class' constructor when instantiating a class to resolve this dependency.
    */

    parameters: null,
<span id='global-property-fn'>    /**
</span>    		Factory function to be executed to obtain the corresponding object instance or value to resolve this dependency.
    		
    		NOTE: For lazily instantiated dependencies, this function will be passed the object instance for which the dependency is being resolved.
    */

    fn: null,
<span id='global-property-value'>    /**
</span>    		Value to use to resolve this dependency.
    */

    value: null,
<span id='global-property-singleton'>    /**
</span>    		Indicates whether this dependency should be resolved as a singleton, or as a transient value for each resolution request.
    */

    singleton: true,
<span id='global-property-eager'>    /**
</span>    		Indicates whether this dependency should be 'eagerly' instantiated when this provider is defined, rather than 'lazily' instantiated when later requested.
    		
    		NOTE: Only valid when either a factory function or class is specified as a singleton.
    */

    eager: false
  },
  constructor: function(config) {
    var classDefinition;
    this.initConfig(config);
    if ((config.value != null) &amp;&amp; config.value.constructor === Object) {
      this.setValue(config.value);
    }
    if (this.getEager()) {
      if (this.getValue() != null) {
        Carcasse.Error.raise({
          msg: &quot;Error while configuring '&quot; + (this.getIdentifier()) + &quot;': a 'value' cannot be created eagerly.&quot;
        });
      }
      if (!this.getSingleton()) {
        Carcasse.Error.raise({
          msg: &quot;Error while configuring '&quot; + (this.getIdentifier()) + &quot;': only singletons can be created eagerly.&quot;
        });
      }
    }
    if (this.getClassName() != null) {
      classDefinition = Carcasse.ClassManager.get(this.getClassName());
      if (!(classDefinition != null)) {
        Deft.Logger.warn(&quot;Synchronously loading '&quot; + (this.getClassName()) + &quot;'; consider adding Carcasse.require('&quot; + (this.getClassName()) + &quot;') above Carcasse.onReady.&quot;);
        Carcasse.syncRequire(this.getClassName());
        classDefinition = Carcasse.ClassManager.get(this.getClassName());
      }
      if (!(classDefinition != null)) {
        Carcasse.Error.raise({
          msg: &quot;Error while configuring rule for '&quot; + (this.getIdentifier()) + &quot;': unrecognized class name or alias: '&quot; + (this.getClassName()) + &quot;'&quot;
        });
      }
    }
    if (!this.getSingleton()) {
      if (this.getClassName() != null) {
        if (Carcasse.ClassManager.get(this.getClassName()).singleton) {
          Carcasse.Error.raise({
            msg: &quot;Error while configuring rule for '&quot; + (this.getIdentifier()) + &quot;': singleton classes cannot be configured for injection as a prototype. Consider removing 'singleton: true' from the class definition.&quot;
          });
        }
      }
      if (this.getValue() != null) {
        Carcasse.Error.raise({
          msg: &quot;Error while configuring '&quot; + (this.getIdentifier()) + &quot;': a 'value' can only be configured as a singleton.&quot;
        });
      }
    } else {
      if ((this.getClassName() != null) &amp;&amp; (this.getParameters() != null)) {
        if (Carcasse.ClassManager.get(this.getClassName()).singleton) {
          Carcasse.Error.raise({
            msg: &quot;Error while configuring rule for '&quot; + (this.getIdentifier()) + &quot;': parameters cannot be applied to singleton classes. Consider removing 'singleton: true' from the class definition.&quot;
          });
        }
      }
    }
    return this;
  },
<span id='global-method-resolve'>  /**
</span>  	Resolve a target instance's dependency with an object instance or value generated by this dependency provider.
  */

  resolve: function(targetInstance) {
    var instance, parameters;
    Deft.Logger.log(&quot;Resolving '&quot; + (this.getIdentifier()) + &quot;'.&quot;);
    if (this.getValue() != null) {
      return this.getValue();
    }
    instance = null;
    if (this.getFn() != null) {
      Deft.Logger.log(&quot;Executing factory function.&quot;);
      instance = this.getFn().call(null, targetInstance);
    } else if (this.getClassName() != null) {
      if (Carcasse.ClassManager.get(this.getClassName()).singleton) {
        Deft.Logger.log(&quot;Using existing singleton instance of '&quot; + (this.getClassName()) + &quot;'.&quot;);
        instance = Carcasse.ClassManager.get(this.getClassName());
      } else {
        Deft.Logger.log(&quot;Creating instance of '&quot; + (this.getClassName()) + &quot;'.&quot;);
        parameters = this.getParameters() != null ? [this.getClassName()].concat(this.getParameters()) : [this.getClassName()];
        instance = Carcasse.create.apply(this, parameters);
      }
    } else {
      Carcasse.Error.raise({
        msg: &quot;Error while configuring rule for '&quot; + (this.getIdentifier()) + &quot;': no 'value', 'fn', or 'className' was specified.&quot;
      });
    }
    if (this.getSingleton()) {
      this.setValue(instance);
    }
    return instance;
  }
});
</pre>
</body>
</html>
